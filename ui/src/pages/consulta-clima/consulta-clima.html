<div id="consulta-clima-page" class="page">
  <ui5-title level="H2">Clima y Procedimientos</ui5-title>

  <ui5-busy-indicator id="pageBusy" size="Large" style="display: none;"></ui5-busy-indicator>

  <ui5-card style="margin-top: 0.5rem;">
    <ui5-card-header title-text="Selecci√≥n"></ui5-card-header>
    <section style="padding: 1rem;">
      <div style="display: flex; align-items: center; margin-bottom: 1rem; padding: 0.5rem; background-color: var(--sapBackgroundColor); border-radius: 0.25rem;">
        <ui5-switch id="simulacionToggle" text-on="Simulaci√≥n ON" text-off="Simulaci√≥n OFF"></ui5-switch>
        <ui5-label style="margin-left: 0.5rem; color: var(--sapTextColor);">Modo Simulaci√≥n (Testing)</ui5-label>
      </div>

      <div id="simulacionPanel" style="display: none; margin-bottom: 1rem; padding: 1rem; background-color: var(--sapGroup_ContentBackground); border: 1px solid var(--sapGroup_BorderColor); border-radius: 0.375rem;">
        <ui5-label for="escenarioSelect" style="margin-bottom: 0.5rem; display: block;">Seleccionar Escenario de Prueba</ui5-label>
        
        <ui5-select id="escenarioSelect" style="width: 100%; margin-bottom: 0.75rem;">
          <ui5-option value="nieve" selected>‚ùÑÔ∏è Nieve - Temperatura -2¬∞C, prob. nieve 85%</ui5-option>
          <ui5-option value="lluvia">üåßÔ∏è Lluvia - Temperatura 1.5¬∞C, prob. lluvia 90%, riesgo hielo</ui5-option>
          <ui5-option value="hielo">üßä Hielo en Pista - Temp. pista -0.8¬∞C, superficie WET (CR√çTICO)</ui5-option>
        </ui5-select>
        
        <ui5-message-strip design="Information" hide-close-button>
          El modo simulaci√≥n genera datos de prueba para testear la creaci√≥n de avisos y la l√≥gica del agente SNOW.
        </ui5-message-strip>
      </div>

      <ui5-label for="citySelect">Estaci√≥n Meteorol√≥gica</ui5-label>
      <ui5-select id="citySelect">
        <ui5-option value="riogrande" selected>R√≠o Grande (-53.7877, -67.7097)</ui5-option>
        <ui5-option value="amsterdam">Amsterdam Schiphol (52.374, 4.8897)</ui5-option>
        <ui5-option value="bariloche">Bariloche (-41.1335, -71.3103)</ui5-option>
        <ui5-option value="nyc">New York City JFK (40.6413, -73.7781)</ui5-option>
      </ui5-select>

      <ui5-label for="dateInput">Fecha</ui5-label>
      <ui5-input id="dateInput" type="Date" placeholder="YYYY-MM-DD"></ui5-input>

      <div style="margin-top: 0.75rem;">
        <ui5-button id="weatherButton" design="Emphasized" icon="sys-enter-2">Consultar</ui5-button>
      </div>
      <ui5-message-strip id="weatherMessage" hide-close-button style="display: none; margin-top: 0.5rem;"></ui5-message-strip>
    </section>
  </ui5-card>

  <ui5-card style="margin-top: 1rem;">
    <ui5-card-header title-text="Resumen del Clima"></ui5-card-header>
    <section style="padding: 1rem;">
      <div id="climaResumen" style="white-space: pre-wrap;"></div>
      
      <!-- Indicadores de Probabilidad de Lluvia y Nieve -->
      <div id="probabilidadesContainer" style="display: none; margin-top: 1rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
        <!-- Probabilidad de Lluvia -->
        <div id="probLluviaCard" style="padding: 1rem; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-radius: 0.5rem; text-align: center; border: 1px solid #90caf9;">
          <div style="font-size: 2rem; margin-bottom: 0.5rem;">üåßÔ∏è</div>
          <div style="font-size: 0.875rem; color: #1565c0; font-weight: 500;">Probabilidad de Lluvia</div>
          <div id="probLluviaValor" style="font-size: 2rem; font-weight: bold; color: #0d47a1;">0%</div>
          <div id="probLluviaDesc" style="font-size: 0.75rem; color: #1976d2;">Sin datos</div>
        </div>
        
        <!-- Probabilidad de Nieve -->
        <div id="probNieveCard" style="padding: 1rem; background: linear-gradient(135deg, #e8eaf6 0%, #c5cae9 100%); border-radius: 0.5rem; text-align: center; border: 1px solid #9fa8da;">
          <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚ùÑÔ∏è</div>
          <div style="font-size: 0.875rem; color: #283593; font-weight: 500;">Probabilidad de Nieve</div>
          <div id="probNieveValor" style="font-size: 2rem; font-weight: bold; color: #1a237e;">0%</div>
          <div id="probNieveDesc" style="font-size: 0.75rem; color: #3949ab;">Sin datos</div>
        </div>
      </div>
      
      <div id="condicionesAdversas" style="margin-top: 0.5rem;"></div>
    </section>
  </ui5-card>

  <!-- Forecast pr√≥ximas horas -->
  <ui5-card id="forecastHorasCard" style="margin-top: 1rem; display: none;">
    <ui5-card-header title-text="Forecast Pr√≥ximas Horas" subtitle-text="Hora actual + 3 horas"></ui5-card-header>
    <section style="padding: 1rem;">
      <ui5-message-strip design="Information" hide-close-button style="margin-bottom: 1rem;">
        Datos de Open-Meteo para las pr√≥ximas 4 horas desde la hora actual.
      </ui5-message-strip>
      <div id="forecastHorasContainer" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem;">
        <!-- Se llenar√°n din√°micamente -->
      </div>
    </section>
  </ui5-card>

  <ui5-card style="margin-top: 1rem;">
    <ui5-card-header title-text="Procedimientos LLM"></ui5-card-header>
    <section style="padding: 1rem;">
      <div id="llmAnswer" style="white-space: pre-wrap;"></div>
      <div id="fuentesList" style="margin-top: 0.5rem;"></div>
    </section>
  </ui5-card>

  <ui5-card id="avisosCard" style="margin-top: 1rem; display: none;">
    <ui5-card-header title-text="Avisos Generados" subtitle-text="Sistema MVP1 SNOW"></ui5-card-header>
    <section style="padding: 1rem;">
      <ui5-label>Avisos detectados seg√∫n condiciones meteorol√≥gicas:</ui5-label>
      <ui5-list id="avisosLista" mode="SingleSelect" style="margin-top: 0.5rem;">
      </ui5-list>
      
      <!-- Detalle del aviso seleccionado -->
      <div id="avisoDetalleSection" style="margin-top: 1.5rem; padding: 1rem; background-color: var(--sapBackgroundColor); border: 1px solid var(--sapGroup_BorderColor); border-radius: 0.375rem;">
        <ui5-title level="H4" style="margin-bottom: 1rem;">Detalle del Aviso</ui5-title>
        
        <!-- C√≥digos SAP en formato texto -->
        <div style="margin-bottom: 1.5rem; padding: 1rem; background-color: var(--sapGroup_ContentBackground); border-radius: 0.25rem; font-family: monospace; font-size: 0.875rem; white-space: pre-wrap;" id="codigosSAPTexto">
        </div>
        
        <!-- Tareas del Procedimiento -->
        <ui5-title level="H5" style="margin-bottom: 0.5rem;">Tareas a Realizar seg√∫n Procedimiento</ui5-title>
        <div id="tareasTexto" style="margin-bottom: 1.5rem; padding: 1rem; background-color: var(--sapGroup_ContentBackground); border-radius: 0.25rem; font-family: monospace; font-size: 0.875rem; white-space: pre-wrap;">
        </div>
        
        <!-- Botones de acci√≥n -->
        <div style="display: flex; gap: 0.75rem; flex-wrap: wrap; margin-top: 1rem;">
          <ui5-button id="descargarAvisoJsonBtn" design="Default" icon="download">
            Descargar Aviso (JSON)
          </ui5-button>
          <ui5-button id="enviarISuiteBtn" design="Emphasized" icon="paper-plane">
            Enviar a SAP Integration Suite
          </ui5-button>
        </div>
        
        <!-- Mensaje de estado del env√≠o a SAP Integration Suite -->
        <ui5-message-strip id="isuiteMensaje" hide-close-button style="display: none; margin-top: 1rem;"></ui5-message-strip>
        
        <!-- Detalles de la respuesta de SAP Integration Suite -->
        <div id="isuiteRespuestaContainer" style="display: none; margin-top: 1rem; padding: 1rem; background-color: var(--sapGroup_ContentBackground); border: 1px solid var(--sapGroup_BorderColor); border-radius: 0.375rem;">
          <ui5-title level="H5" style="margin-bottom: 0.5rem;">Respuesta de SAP Integration Suite</ui5-title>
          <div id="isuiteRespuestaTexto" style="font-family: monospace; font-size: 0.8rem; white-space: pre-wrap; max-height: 200px; overflow-y: auto;"></div>
        </div>
      </div>
    </section>
  </ui5-card>

  <ui5-card style="margin-top: 1rem;">
    <ui5-card-header title-text="Workflow"></ui5-card-header>
    <section style="padding: 1rem;">
      <div id="workflowInfo" style="white-space: pre-wrap;"></div>
    </section>
  </ui5-card>

  <!-- Popover con detalle completo del aviso -->
  <ui5-popover id="avisoDetallePopover" placement-type="Bottom" header-text="Detalle del Aviso">
    <section style="padding: 1rem; max-width: 700px; max-height: 80vh; overflow-y: auto;">
      
      <!-- Informaci√≥n del Aviso -->
      <ui5-title level="H4" style="margin-bottom: 0.5rem;">Informaci√≥n del Aviso</ui5-title>
      <ui5-list id="avisoInfoLista" no-data-text="Sin informaci√≥n">
      </ui5-list>

      <!-- Condiciones Meteorol√≥gicas Evaluadas -->
      <ui5-title level="H4" style="margin-top: 1rem; margin-bottom: 0.5rem;">Condiciones Meteorol√≥gicas</ui5-title>
      <ui5-list id="condicionesMeteoLista" no-data-text="Sin datos">
      </ui5-list>

      <!-- Datos MARWIS -->
      <ui5-title level="H4" style="margin-top: 1rem; margin-bottom: 0.5rem;">Datos MARWIS (Pista)</ui5-title>
      <ui5-list id="marwisLista" no-data-text="Sin datos de MARWIS">
      </ui5-list>

      <!-- Tareas del Procedimiento -->
      <ui5-title level="H4" style="margin-top: 1rem; margin-bottom: 0.5rem;">Tareas a Realizar (Procedimiento)</ui5-title>
      <ui5-list id="tareasProcedimientoLista" no-data-text="Sin tareas">
      </ui5-list>

      <!-- Tareas Hist√≥ricas -->
      <ui5-title level="H4" style="margin-top: 1rem; margin-bottom: 0.5rem;">Tareas Realizadas (Hist√≥rico)</ui5-title>
      <ui5-list id="tareasHistoricoLista" no-data-text="Sin tareas hist√≥ricas">
      </ui5-list>

      <!-- Resumen de Todas las Tareas -->
      <ui5-title level="H4" style="margin-top: 1.5rem; margin-bottom: 0.5rem;">Resumen Completo de Tareas</ui5-title>
      <div id="resumenTareasTexto" style="padding: 1rem; background-color: var(--sapBackgroundColor); border-radius: 0.25rem; white-space: pre-wrap; font-family: monospace; font-size: 0.875rem; max-height: 300px; overflow-y: auto; border: 1px solid var(--sapGroup_BorderColor);">
        Sin informaci√≥n de tareas
      </div>

      <!-- Botones de acci√≥n -->
      <section style="margin-top: 1.5rem; display: flex; justify-content: flex-end; gap: 0.5rem; padding-top: 1rem; border-top: 1px solid var(--sapGroup_BorderColor);">
        <ui5-button id="descargarAvisoJson" design="Emphasized" icon="download">
          Descargar Aviso Completo (JSON)
        </ui5-button>
        <ui5-button id="cerrarPopover" design="Default">
          Cerrar
        </ui5-button>
      </section>
    </section>
  </ui5-popover>
</div>
